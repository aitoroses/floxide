<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
    
    <meta name="description" content="Documentation for the Floxide framework - A type-safe, composable directed graph workflow system written in Rust"> 
    
    <meta name="author" content="Floxide Team"> 
    <link rel="icon" type="image/png" sizes="192x192" href="../../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../../img/favicon-32x32.png" />


    
 
<title>Chapter 8: DistributedOrchestrator - Floxide Documentation</title>


<link href="../../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../../css/normalize.css" rel="stylesheet">
<link href="../../css/terminal.css" rel="stylesheet">
<link href="../../css/theme.css" rel="stylesheet">
<link href="../../css/theme.tile_grid.css" rel="stylesheet">
<link href="../../css/theme.footer.css" rel="stylesheet">
<!-- dark color palette -->
<link href="../../css/palettes/dark.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



    
    <link href="../../css/extra.css" rel="stylesheet">  
    
    

    
    <!-- search css support -->
<link href="../../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "../..",
    shortcuts = "{}";
</script>
<script src="../../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <script src="../../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">Floxide Documentation</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../.." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Home</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                
                
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="1">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../..">Home</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Core Concepts</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/">Overview</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        <span class="
        
    

    terminal-mkdocs-side-nav-item--active terminal-mkdocs-side-nav-section-no-index">Tutorial</span>
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../">Introduction</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../01__transition__enum_/">Chapter 1: Transition Enum</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../02__node__trait____node___macro_/">Chapter 2: Node Trait & node! Macro</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../03__workflowctx_____context__trait_/">Chapter 3: WorkflowCtx & Context Trait</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../04__workflow__trait____workflow___macro_/">Chapter 4: Workflow Trait & workflow! Macro</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../05__workqueue__trait_/">Chapter 5: WorkQueue Trait</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../06__checkpoint_____checkpointstore__trait_/">Chapter 6: Checkpoint & CheckpointStore Trait</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../07__distributedworker__/">Chapter 7: DistributedWorker</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        <span class="

    terminal-mkdocs-side-nav-item--active">Chapter 8: DistributedOrchestrator</span>
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../09_distributed_stores___runinfostore____metricsstore____errorstore____livenessstore____workitemstatestore___/">Chapter 9: Distributed Stores</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../10__retrypolicy_____retrynode__/">Chapter 10: RetryPolicy & RetryNode</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#chapter-8-distributedorchestrator">Chapter 8: DistributedOrchestrator</a></li>
        <li><a href="#whats-the-problem-managing-the-factory-floor">What's the Problem? Managing the Factory Floor</a></li><li><a href="#what-is-a-distributedorchestrator-your-workflow-manager">What is a DistributedOrchestrator? Your Workflow Manager</a></li><li><a href="#how-to-use-the-distributedorchestrator">How to Use the DistributedOrchestrator</a></li><li><a href="#under-the-hood-how-start_run-works">Under the Hood: How start_run Works</a></li><li><a href="#conclusion">Conclusion</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
<section id="mkdocs-terminal-content">
    <h1 id="chapter-8-distributedorchestrator">Chapter 8: <code>DistributedOrchestrator</code><a class="headerlink" href="#chapter-8-distributedorchestrator" title="Permanent link">&para;</a></h1>
<p>In the <a href="../07__distributedworker__/">previous chapter</a>, we met the <code>DistributedWorker</code>. These are the diligent employees in our distributed workflow factory, constantly picking up tasks from the <a href="../05__workqueue__trait_/"><code>WorkQueue</code></a>, processing them using the <a href="../04__workflow__trait____workflow___macro_/"><code>Workflow</code></a> blueprint, and saving progress using the <a href="../06__checkpoint_____checkpointstore__trait_/"><code>CheckpointStore</code></a>.</p>
<p>But wait... if workers just grab tasks from a queue, who puts the <em>first</em> task on the queue? How do we initiate a whole new workflow run? And how do we check on the progress of all these ongoing runs, or maybe stop one if needed?</p>
<h2 id="whats-the-problem-managing-the-factory-floor">What's the Problem? Managing the Factory Floor<a class="headerlink" href="#whats-the-problem-managing-the-factory-floor" title="Permanent link">&para;</a></h2>
<p>Imagine our video processing factory again. We have workers (<code>DistributedWorker</code>) ready at their stations, a job board (<code>WorkQueue</code>) to list tasks, and a way to save progress (<code>CheckpointStore</code>). But we need someone in charge, a <strong>Project Manager</strong>, to:</p>
<ol>
<li><strong>Start New Projects:</strong> Say "Okay, let's start processing this new video, 'intro.mp4'. Here's the initial configuration." This involves setting up the initial shared <a href="../03__workflowctx_____context__trait_/"><code>Context</code></a> in the <code>ContextStore</code> and putting the very first task (like "Download Video") on the job board (<code>WorkQueue</code>).</li>
<li><strong>Monitor Progress:</strong> Walk around the factory floor (figuratively!) and ask "How's the processing for 'intro.mp4' going? Is it done yet? Did any problems occur?" using the <code>RunInfoStore</code>, <code>MetricsStore</code>, <code>ErrorStore</code>, etc.</li>
<li><strong>Control Execution:</strong> Maybe decide "Hold on, stop working on 'outro.mp4' for now," or "Cancel the 'test_video.avi' project entirely."</li>
<li><strong>Gather Reports:</strong> Collect information about how many projects are running, which workers are active, and any errors that have happened.</li>
</ol>
<p>Without this central management figure, our distributed factory would be chaotic. Workers wouldn't know when new projects start, and we wouldn't know how they're progressing.</p>
<p>In Floxide, this project manager role is filled by the <strong><code>DistributedOrchestrator</code></strong>.</p>
<h2 id="what-is-a-distributedorchestrator-your-workflow-manager">What is a <code>DistributedOrchestrator</code>? Your Workflow Manager<a class="headerlink" href="#what-is-a-distributedorchestrator-your-workflow-manager" title="Permanent link">&para;</a></h2>
<p>The <code>DistributedOrchestrator</code> is the central control panel for managing your distributed Floxide workflow runs. It doesn't execute the individual steps itself (that's the <a href="../07__distributedworker__/"><code>DistributedWorker</code></a>'s job), but it provides the interface to interact with the entire distributed system at a higher level.</p>
<p>Think of it as the dashboard and control levers for your workflow factory. Its main responsibilities include:</p>
<ul>
<li><strong>Starting new workflow runs:</strong> This involves providing the initial <a href="../03__workflowctx_____context__trait_/"><code>Context</code></a>, saving it to the <code>ContextStore</code>, and putting the very first <a href="../04__workflow__trait____workflow___macro_/"><code>WorkItem</code></a> onto the <a href="../05__workqueue__trait_/"><code>WorkQueue</code></a>. This "seeds" the workflow run, making it available for workers to pick up.</li>
<li><strong>Querying the status of runs:</strong> Asking "Is run 'video_abc' still running, completed, failed, or paused?" (using <code>RunInfoStore</code>).</li>
<li><strong>Cancelling or pausing runs:</strong> Sending signals to stop or temporarily halt processing for a specific run (updating <code>RunInfoStore</code> and purging <code>WorkQueue</code>).</li>
<li><strong>Retrieving run context:</strong> Fetching the latest shared context data for a run from the <code>ContextStore</code>.</li>
<li><strong>Retrieving run history and metrics:</strong> Getting information about past and present runs from <code>RunInfoStore</code> and <code>MetricsStore</code>.</li>
<li><strong>Checking for errors:</strong> Listing any errors that occurred during a run via <code>ErrorStore</code>.</li>
<li><strong>Monitoring worker liveness:</strong> Checking which workers are active and responsive.</li>
</ul>
<p><strong>Distributed Emphasis:</strong> The <code>DistributedOrchestrator</code> achieves this by interacting with all the shared, distributed stores we've been learning about (and will learn more about in the <a href="../09_distributed_stores___runinfostore____metricsstore____errorstore____livenessstore____workitemstatestore___/">next chapter</a>). It talks to the <code>WorkQueue</code>, <code>ContextStore</code>, <code>RunInfoStore</code>, <code>MetricsStore</code>, <code>ErrorStore</code>, <code>LivenessStore</code>, <code>WorkItemStateStore</code>, etc., to get a unified view of the system and exert control.</p>
<div class="mermaid">graph TD
    Orchestrator[Distributed Orchestrator] -- Manages --&gt; Run1[Workflow Run 'video_abc']
    Orchestrator -- Manages --&gt; Run2[Workflow Run 'audio_xyz']

    subgraph Shared Infrastructure
        WQ[(Work Queue)]
        CtxS[(Context Store)]
        RIS[(RunInfo Store)]
        MS[(Metrics Store)]
        ES[(Error Store)]
        LS[(Liveness Store)]
        WIS[(WorkItemState Store)]
    end

    Orchestrator -- "start_run()" --&gt; WQ &amp; CtxS &amp; RIS
    Orchestrator -- "status()" --&gt; RIS
    Orchestrator -- "cancel()" --&gt; RIS &amp; WQ
    Orchestrator -- "errors()" --&gt; ES
    Orchestrator -- "liveness()" --&gt; LS
    Orchestrator -- "metrics()" --&gt; MS
    Orchestrator -- "context()" --&gt; CtxS</div>
<h2 id="how-to-use-the-distributedorchestrator">How to Use the <code>DistributedOrchestrator</code><a class="headerlink" href="#how-to-use-the-distributedorchestrator" title="Permanent link">&para;</a></h2>
<p>You typically use the <code>DistributedOrchestrator</code> from your main application code, perhaps in response to a user request, an incoming API call, or a scheduled event.</p>
<h3 id="1-creating-an-orchestrator-instance">1. Creating an Orchestrator Instance<a class="headerlink" href="#1-creating-an-orchestrator-instance" title="Permanent link">&para;</a></h3>
<p>First, you need to create an instance of <code>DistributedOrchestrator</code>. This requires providing instances of your <a href="../04__workflow__trait____workflow___macro_/"><code>Workflow</code></a> definition and all the necessary distributed store implementations. These stores <em>must</em> be implementations designed for distributed use (like Redis-backed stores, database stores, etc.) for the system to work across multiple machines.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-0-1"><span class="k">use</span><span class="w"> </span><span class="n">floxide</span><span class="p">::{</span>
</span><span id="__span-0-2"><span class="w">    </span><span class="n">DistributedOrchestrator</span><span class="p">,</span><span class="w"> </span><span class="n">WorkflowCtx</span><span class="p">,</span>
</span><span id="__span-0-3"><span class="w">    </span><span class="n">distributed</span><span class="p">::{</span><span class="w"> </span><span class="n">OrchestratorBuilder</span><span class="p">,</span><span class="w"> </span><span class="n">ContextStore</span><span class="w"> </span><span class="cm">/* other stores */</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-0-4"><span class="w">    </span><span class="c1">// --- Assume these are your types/implementations ---</span>
</span><span id="__span-0-5"><span class="w">    </span><span class="n">workflow</span><span class="p">::</span><span class="n">TextProcessor</span><span class="p">,</span><span class="w"> </span><span class="c1">// Your workflow struct from workflow! macro</span>
</span><span id="__span-0-6"><span class="w">    </span><span class="n">context</span><span class="p">::</span><span class="n">SimpleContext</span><span class="p">,</span><span class="w">  </span><span class="c1">// Your context struct</span>
</span><span id="__span-0-7"><span class="w">    </span><span class="c1">// Concrete store implementations (using Redis as an example)</span>
</span><span id="__span-0-8"><span class="w">    </span><span class="n">RedisWorkQueue</span><span class="p">,</span><span class="w"> </span><span class="n">RedisContextStore</span><span class="p">,</span><span class="w"> </span><span class="n">RedisRunInfoStore</span><span class="p">,</span>
</span><span id="__span-0-9"><span class="w">    </span><span class="n">RedisMetricsStore</span><span class="p">,</span><span class="w"> </span><span class="n">RedisErrorStore</span><span class="p">,</span><span class="w"> </span><span class="n">RedisLivenessStore</span><span class="p">,</span>
</span><span id="__span-0-10"><span class="w">    </span><span class="n">RedisWorkItemStateStore</span><span class="p">,</span>
</span><span id="__span-0-11"><span class="p">};</span>
</span><span id="__span-0-12"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">Arc</span><span class="p">;</span>
</span><span id="__span-0-13">
</span><span id="__span-0-14"><span class="c1">// Assume these are fully configured clients connected to your backend services</span>
</span><span id="__span-0-15"><span class="kd">let</span><span class="w"> </span><span class="n">my_workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextProcessor</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... node instances ... */</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-0-16"><span class="kd">let</span><span class="w"> </span><span class="n">redis_queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisWorkQueue</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-17"><span class="kd">let</span><span class="w"> </span><span class="n">redis_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisContextStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-18"><span class="kd">let</span><span class="w"> </span><span class="n">redis_run_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisRunInfoStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-19"><span class="kd">let</span><span class="w"> </span><span class="n">redis_metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisMetricsStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-20"><span class="kd">let</span><span class="w"> </span><span class="n">redis_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisErrorStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-21"><span class="kd">let</span><span class="w"> </span><span class="n">redis_liveness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisLivenessStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-22"><span class="kd">let</span><span class="w"> </span><span class="n">redis_work_item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RedisWorkItemStateStore</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="cm">/* redis config */</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-0-23">
</span><span id="__span-0-24"><span class="c1">// Create the orchestrator instance using the builder</span>
</span><span id="__span-0-25"><span class="kd">let</span><span class="w"> </span><span class="n">orchestrator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrchestratorBuilder</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
</span><span id="__span-0-26"><span class="w">    </span><span class="p">.</span><span class="n">workflow</span><span class="p">(</span><span class="n">my_workflow</span><span class="p">)</span>
</span><span id="__span-0-27"><span class="w">    </span><span class="p">.</span><span class="n">queue</span><span class="p">(</span><span class="n">redis_queue</span><span class="p">)</span>
</span><span id="__span-0-28"><span class="w">    </span><span class="p">.</span><span class="n">context_store</span><span class="p">(</span><span class="n">redis_context</span><span class="p">)</span>
</span><span id="__span-0-29"><span class="w">    </span><span class="p">.</span><span class="n">run_info_store</span><span class="p">(</span><span class="n">redis_run_info</span><span class="p">)</span>
</span><span id="__span-0-30"><span class="w">    </span><span class="p">.</span><span class="n">metrics_store</span><span class="p">(</span><span class="n">redis_metrics</span><span class="p">)</span>
</span><span id="__span-0-31"><span class="w">    </span><span class="p">.</span><span class="n">error_store</span><span class="p">(</span><span class="n">redis_errors</span><span class="p">)</span>
</span><span id="__span-0-32"><span class="w">    </span><span class="p">.</span><span class="n">liveness_store</span><span class="p">(</span><span class="n">redis_liveness</span><span class="p">)</span>
</span><span id="__span-0-33"><span class="w">    </span><span class="p">.</span><span class="n">work_item_state_store</span><span class="p">(</span><span class="n">redis_work_item</span><span class="p">)</span>
</span><span id="__span-0-34"><span class="w">    </span><span class="p">.</span><span class="n">build</span><span class="p">();</span>
</span><span id="__span-0-35">
</span><span id="__span-0-36"><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Orchestrator created successfully!&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>This code gathers all the necessary components (the workflow logic and connections to all the shared backend stores) and bundles them into an <code>orchestrator</code> object using a convenient builder pattern.</p>
<h3 id="2-starting-a-workflow-run">2. Starting a Workflow Run<a class="headerlink" href="#2-starting-a-workflow-run" title="Permanent link">&para;</a></h3>
<p>The most common action is starting a new run. You provide the initial <a href="../03__workflowctx_____context__trait_/"><code>Context</code></a> and the input data for the first <a href="../02__node__trait____node___macro_/"><code>Node</code></a>.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-1-1"><span class="c1">// Define the initial shared context data for this specific run</span>
</span><span id="__span-1-2"><span class="kd">let</span><span class="w"> </span><span class="n">initial_context_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleContext</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// Or MyWorkflowData { api_key: &quot;...&quot;, ... }</span>
</span><span id="__span-1-3"><span class="kd">let</span><span class="w"> </span><span class="n">wf_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WorkflowCtx</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">initial_context_data</span><span class="p">);</span>
</span><span id="__span-1-4">
</span><span id="__span-1-5"><span class="c1">// Define the input for the very first node in the workflow</span>
</span><span id="__span-1-6"><span class="kd">let</span><span class="w"> </span><span class="n">initial_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;start processing this text&quot;</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span>
</span><span id="__span-1-7">
</span><span id="__span-1-8"><span class="c1">// Call start_run on the orchestrator</span>
</span><span id="__span-1-9"><span class="kd">let</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orchestrator</span><span class="p">.</span><span class="n">start_run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wf_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">initial_input</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-1-10">
</span><span id="__span-1-11"><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Successfully started workflow run with ID: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">run_id</span><span class="p">);</span>
</span><span id="__span-1-12"><span class="c1">// Example Output:</span>
</span><span id="__span-1-13"><span class="c1">// Successfully started workflow run with ID: 1e7a3c4f-8b0a-4b1e-8c7f-9d2e1b0a3d5e</span>
</span></code></pre></div>
<p><strong>What <code>start_run</code> Does:</strong>
*   Generates a unique ID (like <code>1e7a...</code>) for this specific run.
*   Calls the underlying <code>workflow.start_distributed(...)</code> method. This method:
    *   Initializes the context state in the <code>ContextStore</code> using <code>context_store.set(run_id, initial_context_data)</code>.
    *   Determines the first <code>WorkItem</code>(s) based on the <code>start</code> node and the <code>initial_input</code>.
    *   Pushes the first <code>WorkItem</code>(s) onto the <code>WorkQueue</code>.
*   Records the new run's information (ID, status=<code>Running</code>, start time) in the <code>RunInfoStore</code>.
*   Returns the unique <code>run_id</code>.</p>
<p><strong>Crucially, <code>start_run</code> does <em>not</em> execute any workflow logic itself.</strong> It just sets everything up and puts the first task on the queue. The <a href="../07__distributedworker__/"><code>DistributedWorker</code></a>s will eventually see this task on the queue and start processing it.</p>
<h3 id="3-checking-run-status">3. Checking Run Status<a class="headerlink" href="#3-checking-run-status" title="Permanent link">&para;</a></h3>
<p>You can easily check the status of a run using its ID.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-2-1"><span class="kd">let</span><span class="w"> </span><span class="n">run_id_to_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1e7a3c4f-8b0a-4b1e-8c7f-9d2e1b0a3d5e&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// From previous step</span>
</span><span id="__span-2-2">
</span><span id="__span-2-3"><span class="kd">let</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orchestrator</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">run_id_to_check</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-2-4">
</span><span id="__span-2-5"><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Status for run {}: {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">run_id_to_check</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
</span><span id="__span-2-6"><span class="c1">// Example Output (could be Running, Completed, Failed, Paused, Cancelled):</span>
</span><span id="__span-2-7"><span class="c1">// Status for run 1e7a...: Running</span>
</span></code></pre></div>
<p>This queries the <code>RunInfoStore</code> to get the latest recorded status for that <code>run_id</code>.</p>
<h3 id="4-cancelling-a-run">4. Cancelling a Run<a class="headerlink" href="#4-cancelling-a-run" title="Permanent link">&para;</a></h3>
<p>If you need to stop a run prematurely:</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-3-1"><span class="kd">let</span><span class="w"> </span><span class="n">run_id_to_cancel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1e7a3c4f-8b0a-4b1e-8c7f-9d2e1b0a3d5e&quot;</span><span class="p">;</span>
</span><span id="__span-3-2">
</span><span id="__span-3-3"><span class="n">orchestrator</span><span class="p">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">run_id_to_cancel</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-3-4">
</span><span id="__span-3-5"><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Requested cancellation for run {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">run_id_to_cancel</span><span class="p">);</span>
</span><span id="__span-3-6">
</span><span id="__span-3-7"><span class="c1">// Later, checking status might show:</span>
</span><span id="__span-3-8"><span class="c1">// Status for run 1e7a...: Cancelled</span>
</span></code></pre></div>
<p><strong>What <code>cancel</code> Does:</strong>
*   Updates the status in the <code>RunInfoStore</code> to <code>Cancelled</code>.
*   Calls <code>queue.purge_run(run_id)</code> to remove any pending tasks for this run from the <code>WorkQueue</code>.
*   (Note: Workers currently processing a task for this run might finish that task, but they won't pick up new ones. Nodes can also check <code>ctx.is_cancelled()</code> to stop early).</p>
<h3 id="5-other-management-functions">5. Other Management Functions<a class="headerlink" href="#5-other-management-functions" title="Permanent link">&para;</a></h3>
<p>The <code>DistributedOrchestrator</code> provides other useful methods:</p>
<ul>
<li><code>list_runs(filter)</code>: Get a list of all runs, optionally filtering by status.</li>
<li><code>pause(run_id)</code> / <code>resume(run_id)</code>: Temporarily halt or continue a run.</li>
<li><code>errors(run_id)</code>: Retrieve a list of errors recorded for a run from the <code>ErrorStore</code>.</li>
<li><code>metrics(run_id)</code>: Get performance metrics (like step timings) from the <code>MetricsStore</code>.</li>
<li><code>liveness()</code> / <code>list_worker_health()</code>: Check the status of connected workers via the <code>LivenessStore</code>.</li>
<li><code>pending_work(run_id)</code>: See what tasks are currently waiting in the queue for a specific run.</li>
<li><code>context(run_id)</code>: Retrieve the latest saved context data for the run from the <code>ContextStore</code>.</li>
<li><code>wait_for_completion(run_id, poll_interval)</code>: Wait until a run finishes (Completed, Failed, or Cancelled).</li>
</ul>
<p>These methods allow comprehensive monitoring and control over your distributed workflows.</p>
<h2 id="under-the-hood-how-start_run-works">Under the Hood: How <code>start_run</code> Works<a class="headerlink" href="#under-the-hood-how-start_run-works" title="Permanent link">&para;</a></h2>
<p>Let's trace the main steps when you call <code>orchestrator.start_run(ctx, input)</code>:</p>
<ol>
<li><strong>Generate ID:</strong> The <code>start_run</code> method creates a unique <code>run_id</code> (e.g., using UUIDs).</li>
<li><strong>Delegate to Workflow:</strong> It calls <code>self.workflow.start_distributed(ctx, input, &amp;self.context_store, &amp;self.queue, &amp;run_id)</code>.</li>
<li><strong><code>start_distributed</code> (Inside <code>workflow!</code> Macro Code):</strong><ul>
<li>Calls <code>context_store.set(run_id, ctx.store)</code> to save the initial context state.</li>
<li>Determines the first <code>WorkItem</code> based on the workflow's <code>start</code> node and the provided <code>input</code>.</li>
<li>Calls <code>self.queue.enqueue(run_id, first_work_item)</code> to put the first task on the main queue.</li>
</ul>
</li>
<li><strong>Record Run Info:</strong> Back in <code>start_run</code>, it creates a <code>RunInfo</code> struct (status=Running, started_at=now) and calls <code>self.run_info_store.insert_run(run_info)</code>.</li>
<li><strong>Return ID:</strong> <code>start_run</code> returns the generated <code>run_id</code>.</li>
</ol>
<p>Here's a sequence diagram illustrating this:</p>
<div class="mermaid">sequenceDiagram
    participant UserApp as Your Application
    participant Orch as DistributedOrchestrator
    participant WF as Workflow (start_distributed)
    participant CtxS as ContextStore
    participant WQ as WorkQueue
    participant RIS as RunInfoStore

    UserApp-&gt;&gt;Orch: start_run(ctx, input)
    Orch-&gt;&gt;Orch: Generate run_id
    Orch-&gt;&gt;WF: start_distributed(ctx, input, context_store, queue, run_id)
    WF-&gt;&gt;CtxS: set(run_id, ctx.store)
    CtxS--&gt;&gt;WF: Ok
    WF-&gt;&gt;WF: Determine first_item
    WF-&gt;&gt;WQ: enqueue(run_id, first_item)
    WQ--&gt;&gt;WF: Ok
    WF--&gt;&gt;Orch: Ok
    Orch-&gt;&gt;RIS: insert_run(run_id, status=Running, ...)
    RIS--&gt;&gt;Orch: Ok
    Orch--&gt;&gt;UserApp: Return run_id</div>
<p>The <code>DistributedOrchestrator</code> struct itself (defined in <code>floxide-core/src/distributed/orchestrator.rs</code>) mainly holds references to the workflow and all the store implementations.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-4-1"><span class="c1">// Simplified from crates/floxide-core/src/distributed/orchestrator.rs</span>
</span><span id="__span-4-2"><span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">distributed</span><span class="p">::{</span><span class="w"> </span><span class="n">ContextStore</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorStore</span><span class="p">,</span><span class="w"> </span><span class="n">LivenessStore</span><span class="p">,</span><span class="w"> </span><span class="n">MetricsStore</span><span class="p">,</span><span class="w"> </span><span class="n">RunInfoStore</span><span class="p">,</span><span class="w"> </span><span class="n">WorkItemStateStore</span><span class="p">,</span><span class="w"> </span><span class="n">WorkQueue</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-4-3">
</span><span id="__span-4-4"><span class="c1">// Generic struct holding all components</span>
</span><span id="__span-4-5"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">DistributedOrchestrator</span><span class="o">&lt;</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">CS</span><span class="p">,</span><span class="w"> </span><span class="n">RIS</span><span class="p">,</span><span class="w"> </span><span class="n">MS</span><span class="p">,</span><span class="w"> </span><span class="n">ES</span><span class="p">,</span><span class="w"> </span><span class="n">LS</span><span class="p">,</span><span class="w"> </span><span class="n">WIS</span><span class="o">&gt;</span>
</span><span id="__span-4-6"><span class="k">where</span><span class="w"> </span><span class="cm">/* type bounds for Workflow, Context, and all Stores */</span>
</span><span id="__span-4-7"><span class="p">{</span>
</span><span id="__span-4-8"><span class="w">    </span><span class="n">workflow</span><span class="p">:</span><span class="w"> </span><span class="nc">W</span><span class="p">,</span>
</span><span id="__span-4-9"><span class="w">    </span><span class="n">queue</span><span class="p">:</span><span class="w"> </span><span class="nc">Q</span><span class="p">,</span>
</span><span id="__span-4-10"><span class="w">    </span><span class="n">context_store</span><span class="p">:</span><span class="w"> </span><span class="nc">CS</span><span class="p">,</span>
</span><span id="__span-4-11"><span class="w">    </span><span class="n">run_info_store</span><span class="p">:</span><span class="w"> </span><span class="nc">RIS</span><span class="p">,</span>
</span><span id="__span-4-12"><span class="w">    </span><span class="n">metrics_store</span><span class="p">:</span><span class="w"> </span><span class="nc">MS</span><span class="p">,</span>
</span><span id="__span-4-13"><span class="w">    </span><span class="n">error_store</span><span class="p">:</span><span class="w"> </span><span class="nc">ES</span><span class="p">,</span>
</span><span id="__span-4-14"><span class="w">    </span><span class="n">liveness_store</span><span class="p">:</span><span class="w"> </span><span class="nc">LS</span><span class="p">,</span>
</span><span id="__span-4-15"><span class="w">    </span><span class="n">work_item_state_store</span><span class="p">:</span><span class="w"> </span><span class="nc">WIS</span><span class="p">,</span>
</span><span id="__span-4-16"><span class="w">    </span><span class="c1">// PhantomData used for generic type C</span>
</span><span id="__span-4-17"><span class="w">    </span><span class="n">phantom</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">marker</span><span class="p">::</span><span class="n">PhantomData</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-4-18"><span class="p">}</span>
</span><span id="__span-4-19">
</span><span id="__span-4-20"><span class="k">impl</span><span class="o">&lt;..</span><span class="p">.</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DistributedOrchestrator</span><span class="o">&lt;..</span><span class="p">.</span><span class="o">&gt;</span><span class="w"> </span><span class="cm">/* type bounds */</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-21"><span class="w">    </span><span class="c1">// Constructor takes all components</span>
</span><span id="__span-4-22"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span>
</span><span id="__span-4-23"><span class="w">        </span><span class="n">workflow</span><span class="p">:</span><span class="w"> </span><span class="nc">W</span><span class="p">,</span><span class="w"> </span><span class="n">queue</span><span class="p">:</span><span class="w"> </span><span class="nc">Q</span><span class="p">,</span><span class="w"> </span><span class="n">context_store</span><span class="p">:</span><span class="w"> </span><span class="nc">CS</span><span class="p">,</span><span class="w"> </span><span class="n">run_info_store</span><span class="p">:</span><span class="w"> </span><span class="nc">RIS</span><span class="p">,</span><span class="w"> </span><span class="cm">/* etc */</span>
</span><span id="__span-4-24"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... store components ... */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-4-25">
</span><span id="__span-4-26"><span class="w">    </span><span class="c1">// start_run implementation</span>
</span><span id="__span-4-27"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">start_run</span><span class="p">(</span>
</span><span id="__span-4-28"><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span>
</span><span id="__span-4-29"><span class="w">        </span><span class="n">ctx</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">WorkflowCtx</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-4-30"><span class="w">        </span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="nc">W</span><span class="p">::</span><span class="n">Input</span><span class="p">,</span>
</span><span id="__span-4-31"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">FloxideError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-32"><span class="w">        </span><span class="c1">// 1. Generate unique ID</span>
</span><span id="__span-4-33"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">run_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uuid</span><span class="p">::</span><span class="n">Uuid</span><span class="p">::</span><span class="n">new_v4</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span>
</span><span id="__span-4-34">
</span><span id="__span-4-35"><span class="w">        </span><span class="c1">// 2. Delegate to workflow&#39;s seeding primitive</span>
</span><span id="__span-4-36"><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">workflow</span>
</span><span id="__span-4-37"><span class="w">            </span><span class="p">.</span><span class="n">start_distributed</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">context_store</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">run_id</span><span class="p">)</span>
</span><span id="__span-4-38"><span class="w">            </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// Handles context save + queue enqueue</span>
</span><span id="__span-4-39">
</span><span id="__span-4-40"><span class="w">        </span><span class="c1">// 3. Record initial run info</span>
</span><span id="__span-4-41"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">run_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RunInfo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* run_id, status=Running, started_at */</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-4-42"><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">run_info_store</span><span class="p">.</span><span class="n">insert_run</span><span class="p">(</span><span class="n">run_info</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span>
</span><span id="__span-4-43">
</span><span id="__span-4-44"><span class="w">        </span><span class="c1">// 4. Return the ID</span>
</span><span id="__span-4-45"><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span>
</span><span id="__span-4-46"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-47">
</span><span id="__span-4-48"><span class="w">    </span><span class="c1">// ... implementations for status(), cancel(), errors(), etc. ...</span>
</span><span id="__span-4-49"><span class="w">    </span><span class="c1">// These mostly delegate calls to the corresponding store interfaces.</span>
</span><span id="__span-4-50"><span class="p">}</span>
</span></code></pre></div>
<p>The code clearly shows <code>start_run</code> coordinating between generating an ID, calling the workflow's specific seeding logic (<code>start_distributed</code>), and updating the <code>RunInfoStore</code>.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>The <code>DistributedOrchestrator</code> is the essential management interface for your distributed Floxide workflows. It acts as the central point of control, allowing you to:</p>
<ul>
<li><strong>Initiate</strong> new workflow runs in a distributed environment using <code>start_run</code>.</li>
<li><strong>Monitor</strong> their progress (<code>status</code>, <code>metrics</code>, <code>errors</code>, <code>liveness</code>).</li>
<li><strong>Control</strong> their execution (<code>cancel</code>, <code>pause</code>, <code>resume</code>).</li>
</ul>
<p>It achieves this by interacting with the underlying <a href="../04__workflow__trait____workflow___macro_/"><code>Workflow</code></a> definition and, crucially, the various shared <strong>distributed stores</strong> that maintain the state and coordination information for the entire system.</p>
<p>Speaking of these stores, while we've mentioned them (<code>RunInfoStore</code>, <code>MetricsStore</code>, <code>ErrorStore</code>, <code>LivenessStore</code>, <code>WorkItemStateStore</code>), let's take a closer look at what each one does in the next chapter.</p>
<p><strong>Next:</strong> <a href="../09_distributed_stores___runinfostore____metricsstore____errorstore____livenessstore____workitemstatestore___/">Chapter 9: Distributed Stores (<code>RunInfoStore</code>, <code>MetricsStore</code>, <code>ErrorStore</code>, <code>LivenessStore</code>, <code>WorkItemStateStore</code>)</a></p>
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>